<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="1719570c-66fa-42d0-9ad1-ab79e10bfa78" discardOkResults="false" failOnError="false" failTestCaseOnErrors="true" keepSession="false" name="Test2-N-country" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="1719570c-66fa-42d0-9ad1-ab79e10bfa78fileName">Test2-N-country</con:setting>
  </con:settings>
  <con:testStep type="restrequest" name="Cruise Search-R" id="dd11b414-c7d5-4f7d-ba2c-04ebbe1901c3">
    <con:settings/>
    <con:config service="Cruise Search" resourcePath="/esl/search/rest/cruiseSearch" methodName="cruiseSearch" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Cruise Search-R" id="3efd27a3-c060-4ccb-8337-cd10c6b4e444" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:request/>
        <con:originalUri>http://eslaservicestst01.rccl.com/esl/booking/tst2/esl/search/rest/cruiseSearch</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="fd74ac38-bdfb-4436-87d4-b516b363aa6e" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="XPath Match" id="85fb3534-b96d-4cc8-9754-8f757045ca69" name="status">
          <con:configuration>
            <path>declare namespace ns2='http://www.rccl.com/esl/services/search/v2';
//ns2:CruiseSearchResponse[1]/header[1]/status[1]</path>
            <content>Success</content>
            <allowWildcards>false</allowWildcards>
            <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
            <ignoreComments>false</ignoreComments>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="criteria.brand.value" value="R"/>
          <con:entry key="header.application" value="royalcaribbean.com"/>
          <con:entry key="qualifiers.itineraryGroup.value" value=""/>
          <con:entry key="criteria.ship.value" value="${#Global#royalShip}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>criteria.channel</con:entry>
          <con:entry>criteria.bookingType</con:entry>
          <con:entry>header.domainId</con:entry>
          <con:entry>header.language</con:entry>
          <con:entry>header.application</con:entry>
          <con:entry>criteria.brand.value</con:entry>
          <con:entry>criteria.ship.value</con:entry>
          <con:entry>criteria.cruiseType.value</con:entry>
          <con:entry>criteria.office</con:entry>
          <con:entry>criteria.country</con:entry>
          <con:entry>criteria.currency</con:entry>
          <con:entry>criteria.occupancy.adult</con:entry>
          <con:entry>resultsPreference.pagination.offset</con:entry>
          <con:entry>resultsPreference.pagination.count</con:entry>
          <con:entry>resultsPreference.strictSearch</con:entry>
          <con:entry>resultsPreference.sortBy</con:entry>
          <con:entry>resultsPreference.sortOrder</con:entry>
          <con:entry>resultsPreference.groupBy</con:entry>
          <con:entry>resultsPreference.includeResults</con:entry>
          <con:entry>resultsPreference.includeOnlyIfPriceAvailable</con:entry>
          <con:entry>resultsPreference.priceLevel.bestPricedCategory</con:entry>
          <con:entry>resultsPreference.includePrices</con:entry>
          <con:entry>qualifiers.priceScope</con:entry>
          <con:entry>qualifiers.qualifierScope</con:entry>
          <con:entry>qualifiers.offersType.strictPricingFlag</con:entry>
          <con:entry>qualifiers.itineraryGroup.value</con:entry>
          <con:entry>criteria.sailingDate.dateRange.from</con:entry>
          <con:entry>criteria.sailingDate.dateRange.to</con:entry>
          <con:entry>criteria.sailingDate.date</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="c3a4b580-ecc4-4d69-9e64-f4e9abf07977">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="1c5befc7-2431-43ac-871b-0634d210ea0b">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="40616221-3f9c-4753-b281-39f5bafc4e2c">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Fetch_REQ_app/country/brand/shipCode" id="659d3ed2-8e18-4645-a84a-341849476c92">
    <con:settings/>
    <con:config>
      <script>import java.io.*;
import java.util.*;
import com.eviware.soapui.model.testsuite.*;
import com.eviware.soapui.impl.wsdl.teststeps.assertions.*;
import org.apache.commons.lang3.StringUtils;


def ts = testRunner.testCase.getTestStepByName("Cruise Search-R");
String  url =  ts.getHttpRequest().getResponse().getURL(); 
log.info(url)

String app = StringUtils.substringBetween(url, "header.application=", "&amp;");
log.info(app)
testRunner.testCase.setPropertyValue("application",app);

String country = StringUtils.substringBetween(url, "criteria.country=", "&amp;");
log.info(country)
testRunner.testCase.setPropertyValue("country",country);

String brand = StringUtils.substringBetween(url, "criteria.brand.value=", "&amp;");
log.info(brand)
testRunner.testCase.setPropertyValue("brand",brand);

String language = StringUtils.substringBetween(url, "header.language=", "&amp;");
log.info(language)
testRunner.testCase.setPropertyValue("language",language);</script>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Country-R-with blank country" id="78f56eba-0432-48c1-b18e-7abdd5d4d8e1">
    <con:settings/>
    <con:config service="Microservice" resourcePath="/country" methodName="country" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Country-R-with blank country" id="07d12614-39e4-4853-8389-d0488c74da8d" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment>&lt;con:entry key="env" value="${#Project#env}" xmlns:con="http://eviware.com/soapui/config"/>&lt;con:entry key="AppKey" value="${#Project#AppKey}" xmlns:con="http://eviware.com/soapui/config"/>&lt;/xml-fragment></con:setting>
        </con:settings>
        <con:endpoint xsi:nil="true"/>
        <con:request/>
        <con:originalUri>https://tst1-int.api.rccl.com/en/R/web/v1/esl/country</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="f0b0ba51-fa2d-4de5-9fb5-b5579083cd88" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>500</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="Simple Contains" id="c43252fa-7b10-40bf-99e3-d6a14be1788f" name="Contains">
          <con:configuration>
            <token>One of these is required.</token>
            <ignoreCase>false</ignoreCase>
            <useRegEx>false</useRegEx>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="domain" value="${#TestCase#application}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>countryCode</con:entry>
          <con:entry>domain</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="865e8ee2-30cb-4201-ad02-fccb10024a78">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="5ad2e84c-079e-4d5f-adc1-35f1ed43ec46">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3a1c1eb5-389d-4e62-940e-93b8313dff56">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3ff2ba31-62a8-4b2c-a96b-ded60eb5f611">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="Country-R-with bad country" id="f58296a0-e01f-45b8-bd59-bc0708f7698f">
    <con:settings/>
    <con:config service="Microservice" resourcePath="/country" methodName="country" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="Country-R-with bad country" id="07d12614-39e4-4853-8389-d0488c74da8d" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment>&lt;con:entry key="env" value="${#Project#env}" xmlns:con="http://eviware.com/soapui/config"/>&lt;con:entry key="AppKey" value="${#Project#AppKey}" xmlns:con="http://eviware.com/soapui/config"/>&lt;/xml-fragment></con:setting>
        </con:settings>
        <con:endpoint xsi:nil="true"/>
        <con:request/>
        <con:originalUri>https://tst1-int.api.rccl.com/en/R/web/v1/esl/country</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="f0b0ba51-fa2d-4de5-9fb5-b5579083cd88" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>500</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="XPath Match" id="2a2b8e29-3ae0-494c-8d10-4576c71c737d" name="errorCode">
          <con:configuration>
            <path>declare namespace ns1='https://tst1-int.api.rccl.com/en/R/web/v1/esl/country';
//ns1:Fault[1]/ns1:errors[1]/ns1:e[1]/ns1:errorCode[1]</path>
            <content>CTRY-01</content>
            <allowWildcards>false</allowWildcards>
            <ignoreNamspaceDifferences>false</ignoreNamspaceDifferences>
            <ignoreComments>false</ignoreComments>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="countryCode" value="SSS"/>
          <con:entry key="domain" value="${#TestCase#application}"/>
        </con:parameters>
        <con:parameterOrder>
          <con:entry>countryCode</con:entry>
          <con:entry>domain</con:entry>
        </con:parameterOrder>
        <con:environmentSpec>
          <con:entry environmentId="865e8ee2-30cb-4201-ad02-fccb10024a78">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="5ad2e84c-079e-4d5f-adc1-35f1ed43ec46">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3a1c1eb5-389d-4e62-940e-93b8313dff56">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
          <con:entry environmentId="3ff2ba31-62a8-4b2c-a96b-ded60eb5f611">
            <con:authProfile>Inherit From Parent</con:authProfile>
          </con:entry>
        </con:environmentSpec>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>application</con:name>
      <con:value>royalcaribbean.com</con:value>
    </con:property>
    <con:property>
      <con:name>country</con:name>
      <con:value>USA</con:value>
    </con:property>
    <con:property>
      <con:name>brand</con:name>
      <con:value>R</con:value>
    </con:property>
    <con:property>
      <con:name>language</con:name>
      <con:value>en_us</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
</con:testCase>
