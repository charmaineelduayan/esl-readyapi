<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="b5ee7657-8860-4013-ab62-9f75b3176949" discardOkResults="false" failOnError="false" failTestCaseOnErrors="true" keepSession="false" name="Validate qualifiers.ItineraryGroup.value by passing 1 groupId" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="b5ee7657-8860-4013-ab62-9f75b3176949fileName">Validate-qualifiers.ItineraryGroup.value-by-passing-1-groupId</con:setting>
  </con:settings>
  <con:testStep type="restrequest" name="CruiseSearch" id="9453a66a-3ace-44a0-bb0c-903fd99a86d6">
    <con:settings/>
    <con:config service="Cruise Search" methodName="cruiseSearch" resourcePath="/esl/search/rest/cruiseSearch" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="CruiseSearch" id="e6eaad92-4c9c-4092-a2a9-d2b5f42218c7" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:request/>
        <con:originalUri>http://eslaservicestst01.rccl.com/esl/search/rest/cruiseSearch</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="5ae5bdec-a1e4-42a5-a9b4-6f78b89881d6" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="header.application" value="celebritycruises.com"/>
          <con:entry key="resultsPreference.includeOnlyIfPriceAvailable" value="true"/>
          <con:entry key="criteria.channel" value="VP"/>
          <con:entry key="qualifiers.offersType.strictPricingFlag" value="true"/>
          <con:entry key="resultsPreference.pagination.offset" value="0"/>
          <con:entry key="resultsPreference.includeResults" value="true"/>
          <con:entry key="criteria.ship.value" value="ML"/>
          <con:entry key="resultsPreference.sortOrder" value="DESCENDING"/>
          <con:entry key="resultsPreference.includePrices" value="true"/>
          <con:entry key="resultsPreference.groupBy" value="ITINERARY"/>
          <con:entry key="criteria.bookingType" value="FIT"/>
          <con:entry key="resultsPreference.pagination.count" value="100"/>
          <con:entry key="qualifiers.qualifierScope" value="SEARCH_AND_PRICE"/>
          <con:entry key="header.language" value="en_us"/>
          <con:entry key="criteria.brand.value" value="C"/>
          <con:entry key="qualifiers.priceScope" value="REQUESTED_AVAILABLE"/>
          <con:entry key="criteria.office" value="MIA"/>
          <con:entry key="criteria.currency" value="USD"/>
          <con:entry key="resultsPreference.strictSearch" value="true"/>
          <con:entry key="resultsPreference.priceLevel.bestPricedCategory" value="true"/>
          <con:entry key="header.domainId" value="1"/>
          <con:entry key="criteria.country" value="USA"/>
          <con:entry key="criteria.cruiseType.value" value="CO"/>
          <con:entry key="criteria.occupancy.adult" value="2"/>
        </con:parameters>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="transfer" name="Property Transfer qualifiers.ItineraryGroup.Value" id="837252c3-7527-4580-9433-18baea884f8f">
    <con:settings/>
    <con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false">
        <con:name>GroupID</con:name>
        <con:sourceType>ResponseAsXml</con:sourceType>
        <con:sourceStep>CruiseSearch</con:sourceStep>
        <con:sourcePath>declare namespace ns2='http://www.rccl.com/esl/services/search/v2';
//ns2:CruiseSearchResponse[1]/resultsByPackage[1]/packageSummaryWithClassLevelPricing[2]/packageReference[1]/@code</con:sourcePath>
        <con:targetType>qualifiers.itineraryGroup.value</con:targetType>
        <con:targetStep>CruiseSearch transfer qualifiers.ItineraryGroup.Value</con:targetStep>
        <con:targetPath/>
        <con:upgraded>true</con:upgraded>
      </con:transfers>
    </con:config>
  </con:testStep>
  <con:testStep type="restrequest" name="CruiseSearch transfer qualifiers.ItineraryGroup.Value" id="40d7045a-adc2-4c97-81fd-e5c51c07f8df">
    <con:settings/>
    <con:config service="Cruise Search" methodName="cruiseSearch" resourcePath="/esl/search/rest/cruiseSearch" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:restRequest name="CruiseSearch transfer qualifiers.ItineraryGroup.Value" id="2b560ae6-cf8e-4fef-aaed-77f2710195f3" mediaType="application/json">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:request/>
        <con:originalUri>http://eslaservicestst01.rccl.com/esl/search/rest/cruiseSearch</con:originalUri>
        <con:assertion type="Valid HTTP Status Codes" id="01342b47-d732-4331-8ab0-71a094597a85" name="Valid HTTP Status Codes">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:parameters>
          <con:entry key="header.application" value="celebritycruises.com"/>
          <con:entry key="resultsPreference.includeOnlyIfPriceAvailable" value="true"/>
          <con:entry key="criteria.channel" value="VP"/>
          <con:entry key="qualifiers.offersType.strictPricingFlag" value="true"/>
          <con:entry key="resultsPreference.pagination.offset" value="0"/>
          <con:entry key="resultsPreference.includeResults" value="true"/>
          <con:entry key="criteria.ship.value" value="ML"/>
          <con:entry key="resultsPreference.sortOrder" value="DESCENDING"/>
          <con:entry key="resultsPreference.includePrices" value="true"/>
          <con:entry key="qualifiers.itineraryGroup.value" value="ML07SJU-201436578"/>
          <con:entry key="resultsPreference.groupBy" value="ITINERARY"/>
          <con:entry key="criteria.bookingType" value="FIT"/>
          <con:entry key="resultsPreference.pagination.count" value="100"/>
          <con:entry key="qualifiers.qualifierScope" value="SEARCH_AND_PRICE"/>
          <con:entry key="header.language" value="en_us"/>
          <con:entry key="criteria.brand.value" value="C"/>
          <con:entry key="qualifiers.priceScope" value="REQUESTED_AVAILABLE"/>
          <con:entry key="criteria.office" value="MIA"/>
          <con:entry key="criteria.currency" value="USD"/>
          <con:entry key="resultsPreference.strictSearch" value="true"/>
          <con:entry key="resultsPreference.priceLevel.bestPricedCategory" value="true"/>
          <con:entry key="header.domainId" value="1"/>
          <con:entry key="criteria.country" value="USA"/>
          <con:entry key="criteria.cruiseType.value" value="CO"/>
          <con:entry key="criteria.occupancy.adult" value="2"/>
          <con:entry key="resultsPreference.sortBy" value="DURATION"/>
        </con:parameters>
      </con:restRequest>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Validation by 1 groupID" id="0469646d-7ce4-45a4-82ce-283387ea21da">
    <con:settings/>
    <con:config>
      <script>import java.io.*;
import java.util.*;
import com.eviware.soapui.model.testsuite.*;
import com.eviware.soapui.impl.wsdl.teststeps.assertions.*;
import groovy.json.JsonSlurper
import com.eviware.soapui.settings.SSLSettings
import com.eviware.soapui.SoapUI 


def ts = testRunner.testCase.getTestStepByName("CruiseSearch transfer qualifiers.ItineraryGroup.Value");
def res = new XmlSlurper().parseText(ts.getPropertyValue("ResponseAsXml"));


int  CountTotalHits = (res.resultsSummary.totalHits.text()).toInteger()
int countItineraries = res.resultsByPackage.packageSummaryWithClassLevelPricing.size()


assert CountTotalHits==countItineraries

for(totalHits=0; totalHits&lt;=CountTotalHits-1;totalHits++){
def getCountTotalHits = res.resultsSummary.totalHits[totalHits].size()
log.info('CountTotalHits: '+getCountTotalHits)



	for(groupId=0;groupId&lt;=countItineraries-1;groupId++){
	def getPackage = res.resultsByPackage.packageSummaryWithClassLevelPricing[groupId].packageReference.@code.text()
	log.info('qualifiers.ItineraryGroup.value: '+getPackage)

	int sailings = res.resultsByPackage.packageSummaryWithClassLevelPricing[groupId].cabinClassPriceBySailing.size()
	log.info('cabinClassPriceBySailingLength: '+sailings)
		
			for(packageCode=0; packageCode&lt;=sailings-1;packageCode++){
				def getSailingPackage = res.resultsByPackage.packageSummaryWithClassLevelPricing[groupId].cabinClassPriceBySailing[packageCode].sailingRef.@package.text()
				log.info('Packages inside ClassPriceBySailing: '+getSailingPackage)
				//assert getPackage==getSailingPackage
			
			
			def matchShipNight = getPackage[0..3]
				log.info('match ship &amp; Night:'+ matchShipNight)

				assert getSailingPackage.contains(matchShipNight)
			}

	
}	
}</script>
    </con:config>
  </con:testStep>
  <con:properties/>
  <con:reportParameters/>
</con:testCase>
